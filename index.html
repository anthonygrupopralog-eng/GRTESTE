<!DOCTYPE html>
<html lang="pt-BR">
<head>
<link rel="icon" href="https://www.pralog.com.br/wp-content/uploads/2025/07/cropped-pralogverde-scaled-e1752780666907-32x32.png" sizes="32x32">
<link rel="icon" href="https://www.pralog.com.br/wp-content/uploads/2025/07/cropped-pralogverde-scaled-e1752780666907-192x192.png" sizes="192x192">
<link rel="apple-touch-icon" href="https://www.pralog.com.br/wp-content/uploads/2025/07/cropped-pralogverde-scaled-e1752780666907-180x180.png">
<meta name="msapplication-TileImage" content="https://www.pralog.com.br/wp-content/uploads/2025/07/cropped-pralogverde-scaled-e1752780666907-270x270.png">
<meta charset="UTF-8">
<title>Checklist de Frota</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{background:#f4f6f8;color:#333;padding:20px}
.hidden{display:none}

.header{background:#1f2937;color:#fff;padding:20px;border-radius:10px;margin-bottom:20px}

.dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px}
.card{background:#fff;border-radius:12px;padding:20px;box-shadow:0 4px 8px rgba(0,0,0,.08)}
.card span{font-size:26px;font-weight:bold}
.card.total{border-left:6px solid #3b82f6}
.card.ok{border-left:6px solid #22c55e}
.card.warning{border-left:6px solid #facc15}
.card.danger{border-left:6px solid #ef4444}

.filters{background:#fff;padding:15px;border-radius:10px;display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px}
.filters input,.filters select{padding:10px;border-radius:8px;border:1px solid #d1d5db}

button{padding:8px 18px;border:none;border-radius:10px;background:#111827;color:#fff;cursor:pointer}
button:hover{background:#1f2937}
button:disabled{opacity:.6}

.table-container{background:#fff;padding:15px;border-radius:10px}
table{width:100%;border-collapse:collapse}
th,td{padding:12px;border-bottom:1px solid #e5e7eb}
.center{text-align:center}
.status.ok{color:#16a34a;font-weight:bold}
.status.warning{color:#ca8a04;font-weight:bold}
.status.danger{color:#dc2626;font-weight:bold}

/* LOGIN */
#loginBox{
  max-width:400px;
  margin:100px auto;
  background:#fff;
  padding:30px;
  border-radius:12px;
  box-shadow:0 10px 20px rgba(0,0,0,.15)
}
#loginBox h2{text-align:center;margin-bottom:20px}
#loginBox input{width:100%;padding:12px;margin-bottom:12px;border-radius:8px;border:1px solid #ccc}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <h2>Login</h2>
  <input id="email" placeholder="Email">
  <input id="senha" type="password" placeholder="Senha">
  <button id="btnLogin" style="width:100%">Entrar</button>
  <button id="btnRegister" style="width:100%;margin-top:10px;background:#2563eb">Registrar</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<div class="header">
  <h2>Checklist Mensal da Frota</h2>
  <button id="btnLogout" style="float:right;background:#dc2626">Sair</button>
</div>

<div class="dashboard">
  <div class="card total">Total<br><span id="total">0</span></div>
  <div class="card ok">Em dia<br><span id="ok">0</span></div>
  <div class="card warning">Pendentes<br><span id="pendente">0</span></div>
  <div class="card danger">Vencidos<br><span id="vencido">0</span></div>
</div>

<div class="filters">
  <input id="placaInput" placeholder="Placa">
  <select id="tipoInput">
    <option value="">Tipo</option>
    <option>Truck</option>
    <option>Carreta</option>
    <option>VUC</option>
    <option>Cavalo</option>
  </select>
  <button id="btnCadastrar">Cadastrar Placa</button>
</div>

<div class="table-container">
<table>
<thead>
<tr>
  <th>Placa</th>
  <th class="center">Tipo</th>
  <th class="center">Último Checklist</th>
  <th class="center">Status</th>
  <th class="center">Ação</th>
</tr>
</thead>
<tbody id="tabela"></tbody>
</table>
</div>

</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB61mrR6417ECkuUCsbBqLU3KQ_hepXiQs",
  authDomain: "check-list-d32b1.firebaseapp.com",
  projectId: "check-list-d32b1",
};

const appFirebase = initializeApp(firebaseConfig);
const auth = getAuth(appFirebase);
const db = getFirestore(appFirebase);

/* ELEMENTOS */
const loginBox = document.getElementById("loginBox");
const app = document.getElementById("app");

const email = document.getElementById("email");
const senha = document.getElementById("senha");
const btnLogin = document.getElementById("btnLogin");
const btnRegister = document.getElementById("btnRegister");
const btnLogout = document.getElementById("btnLogout");

const placaInput = document.getElementById("placaInput");
const tipoInput = document.getElementById("tipoInput");
const btnCadastrar = document.getElementById("btnCadastrar");
const tabela = document.getElementById("tabela");

const totalEl = document.getElementById("total");
const okEl = document.getElementById("ok");
const pendenteEl = document.getElementById("pendente");
const vencidoEl = document.getElementById("vencido");

/* LOGIN */
btnLogin.onclick = async ()=>{
  await signInWithEmailAndPassword(auth,email.value,senha.value);
}

btnRegister.onclick = async ()=>{
  const cred = await createUserWithEmailAndPassword(auth,email.value,senha.value);
  await addDoc(collection(db,"users"),{uid:cred.user.uid,role:"admin"});
  alert("Usuário criado (admin)");
}

btnLogout.onclick = ()=>signOut(auth);

/* AUTH STATE */
onAuthStateChanged(auth,(user)=>{
  if(user){
    loginBox.classList.add("hidden");
    app.classList.remove("hidden");
    renderizar();
  }else{
    loginBox.classList.remove("hidden");
    app.classList.add("hidden");
  }
});

/* CADASTRAR PLACA */
btnCadastrar.onclick = async ()=>{
  if(!placaInput.value || !tipoInput.value) return alert("Preencha tudo");
  await addDoc(collection(db,"placas"),{
    placa:placaInput.value.toUpperCase(),
    tipo:tipoInput.value
  });
  placaInput.value="";
  tipoInput.value="";
  renderizar();
};

/* STATUS */
function status(data){
  if(!data) return ["Pendente","warning"];
  const diff = (new Date()-new Date(data))/(1000*60*60*24);
  if(diff<30) return ["Em dia","ok"];
  if(diff===30) return ["Pendente","warning"];
  return ["Vencido","danger"];
}

/* RENDER */
async function renderizar(){
  tabela.innerHTML="";
  let total=0,ok=0,pend=0,ven=0;

  const placas = await getDocs(collection(db,"placas"));
  const checks = await getDocs(collection(db,"checklists"));

  const map={};
  checks.forEach(d=>{
    const c=d.data();
    if(!map[c.placa]||map[c.placa]<c.data) map[c.placa]=c.data;
  });

  placas.forEach(d=>{
    total++;
    const p=d.data();
    const data=map[p.placa];
    const [txt,cls]=status(data);
    if(txt==="Em dia") ok++;
    else if(txt==="Pendente") pend++;
    else ven++;

    tabela.innerHTML+=`
    <tr>
      <td>${p.placa}</td>
      <td class="center">${p.tipo}</td>
      <td class="center">${data||"-"}</td>
      <td class="center status ${cls}">${txt}</td>
      <td class="center"><button onclick="check('${p.placa}')">Checklist</button></td>
    </tr>`;
  });

  totalEl.innerText=total;
  okEl.innerText=ok;
  pendenteEl.innerText=pend;
  vencidoEl.innerText=ven;
}

/* CHECKLIST */
window.check = async (placa)=>{
  const hoje=new Date().toISOString().slice(0,10);
  const q=query(collection(db,"checklists"),where("placa","==",placa),where("data","==",hoje));
  if(!(await getDocs(q)).empty) return alert("Já feito hoje");
  await addDoc(collection(db,"checklists"),{placa,data:hoje});
  renderizar();
}
</script>

</body>
</html>
